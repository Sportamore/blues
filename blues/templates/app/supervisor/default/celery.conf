{%- if not queues %}

{% extends 'supervisor/default/program.conf' %}
{% block program_name -%}worker{% endblock program_name -%}
{% block program -%}
# Start before celery beat
priority=998
command={{ virtualenv }}/bin/celery worker --app={{ module }} -l info -c {{ workers }}

[group:celery_worker]
programs=worker

{%- endblock program %}

{% else %}

    {% for program_name, queue in queues.iteritems() %}
{% include 'supervisor/default/program.conf' %}
command={{ virtualenv }}/bin/celery worker --app={{ module }} -c {{ queue.workers }} -Q {{ program_name }} -E -n {{ program_name}}-worker@%%h -l info
    {% endfor %}

[group:celery_worker]
programs={{ queues.keys()|join(',') }}

{% endif -%}
